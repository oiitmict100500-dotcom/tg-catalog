# Решение проблемы с отображением ресурсов на Vercel

## Анализ проблемы

После изучения документации Vercel Postgres и проверки кода выявлены следующие потенциальные проблемы:

### 1. Использование @vercel/postgres vs pg

В текущем коде используется гибридный подход:
- Если есть `POSTGRES_URL` и это Vercel Postgres → используем `@vercel/postgres`
- Иначе → используем `pg` с `DATABASE_URL`

**Проблема:** `@vercel/postgres` использует template literals, а мы конвертируем параметры в строку для `sql.unsafe`, что может вызывать проблемы с экранированием.

### 2. Рекомендуемое решение

Использовать библиотеку `pg` для всех запросов, так как:
- Она поддерживает стандартные параметризованные запросы ($1, $2, $3)
- Работает одинаково для всех PostgreSQL баз (Vercel Postgres, Neon, Supabase)
- Более надежна и предсказуема

### 3. Проверка работы

Создан тестовый endpoint: `/api/resources/check-status`

Он покажет:
- Все ресурсы с их статусами
- Статистику по статусам (сколько pending, approved, rejected)
- Список pending и approved ресурсов

## Рекомендации

1. **Использовать только `pg` библиотеку** - убрать логику с @vercel/postgres
2. **Проверить endpoint `/api/resources/check-status`** - убедиться, что ресурсы сохраняются с правильными статусами
3. **Проверить логи Vercel** - убедиться, что UPDATE запросы выполняются успешно
4. **Проверить, что поле `status` действительно создано в таблице**

## Следующие шаги

1. Откройте `/api/resources/check-status` после деплоя
2. Проверьте, что ресурсы имеют правильные статусы
3. Если статусы правильные, но ресурсы не отображаются - проблема в фильтрации
4. Если статусы не обновляются - проблема в UPDATE запросах

