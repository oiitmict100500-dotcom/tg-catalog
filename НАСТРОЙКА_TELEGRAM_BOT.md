# Настройка Telegram Login Widget

## Проблема: "Bot domain invalid"

Эта ошибка возникает, когда домен для Telegram Login Widget не настроен в BotFather.

## Решение:

### Вариант 1: Для локальной разработки (localhost)

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/setdomain`
3. Выберите вашего бота (например, `tgcatalog_bot`)
4. Введите домен: `localhost`

**Примечание:** Telegram Login Widget будет работать только если сайт открыт через `http://localhost:3001`, а не через `127.0.0.1` или IP-адрес.

### Вариант 2: Для разработки через ngrok (рекомендуется)

Если нужен доступ с других устройств или для тестирования:

1. Установите [ngrok](https://ngrok.com/)
2. Запустите команду: `ngrok http 3001`
3. Скопируйте полученный URL (например: `https://abc123.ngrok.io`)
4. В BotFather выполните `/setdomain`, выберите бота
5. Введите домен: `abc123.ngrok.io` (без `https://`)

### Вариант 3: Для продакшена

1. В BotFather выполните `/setdomain`
2. Выберите вашего бота
3. Введите ваш домен (например: `example.com` или `www.example.com`)

## Важно:

- Домен должен быть без `http://` или `https://`
- Не используйте порт в домене (например, `localhost:3001` - неправильно, `localhost` - правильно)
- Для каждого домена нужно отдельно настраивать через BotFather
- Если используете поддомены (www и без www), нужно настроить оба

## Проверка:

После настройки домена:
1. Обновите страницу с Telegram Login Widget
2. Попробуйте авторизоваться через кнопку
3. Если ошибка исчезла - настройка выполнена правильно

## Диагностика проблем:

### Проблема: "Bot domain invalid"
**Решение:** Убедитесь, что домен настроен в BotFather через `/setdomain`

### Проблема: "Неверные данные авторизации Telegram"
**Возможные причины:**
1. Домен не настроен в BotFather
2. Неправильный bot token в переменных окружения
3. Данные авторизации устарели (старше 24 часов)

**Решение:**
1. Проверьте настройку домена в BotFather
2. Убедитесь, что переменная окружения `TELEGRAM_BOT_TOKEN` или `BOT_TOKEN` установлена
3. Попробуйте авторизоваться заново

### Проблема: Кнопка Telegram не отображается
**Решение:**
1. Откройте консоль браузера (F12)
2. Проверьте наличие ошибок загрузки скрипта `telegram-widget.js`
3. Убедитесь, что контейнер `telegram-login-container` существует на странице

### Проблема: Ошибка CORS
**Решение:**
1. Убедитесь, что backend запущен на порту 3000
2. Проверьте настройки CORS в `backend/src/main.ts`
3. Убедитесь, что frontend использует прокси для `/api` запросов

### Проверка через консоль браузера:

Откройте консоль (F12) и проверьте:
- Загружается ли скрипт `telegram-widget.js`
- Есть ли ошибки при вызове `/api/auth/telegram`
- Какие данные отправляются на сервер

### Проверка на сервере:

В логах backend должны быть сообщения:
- `Telegram auth verification:` (в dev режиме) - показывает процесс проверки хеша
- `Telegram auth verification failed` - если проверка не прошла

